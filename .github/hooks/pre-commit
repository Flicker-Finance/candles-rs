#!/bin/bash
set -e  # Exit on any error

echo "ğŸš€ Quick pre-commit check..."

# Function to check if command succeeded
check_step() {
  if [ $? -ne 0 ]; then
    echo "âŒ $1 step failed."
    exit 1
  else
    echo "âœ… $1 step passed."
  fi
}

# Format the code and stage changes
echo "ğŸ“ Formatting code..."
cargo fmt --all
git add -u  # Stage any formatting changes

# Quick compile check
echo "ğŸ”§ Checking if code compiles..."
cargo check --quiet
check_step "Compile check"

# Basic clippy for obvious issues
echo "ğŸ” Quick lint check..."
cargo clippy --quiet
check_step "Lint check"

# Run tests
echo "ğŸ§ª Running tests..."
cargo test --quiet
check_step "Tests"

echo "âœ¨ All good! Code is formatted, compiles, and tests pass."
exit 0
